// Test: Basic JSON parsing with callbacks
data User {
    string name;
    int age;
    string email;
}

component JsonTest {
    mut string status = "Not started";
    mut User user;

    def handleUser(User u, UserMeta meta) : void {
        user = u;
        if (meta.has_name() && meta.has_age()) {
            status = "Success: {u.name}, {u.age}";
        } else {
            status = "Partial data received";
        }
    }

    def handleError(string error) : void {
        status = "Error: " + error;
    }

    def parseJson() : void {
        string json = "{\"name\": \"Alice\", \"age\": 25, \"email\": \"alice@example.com\"}";
        Json.parse(
            User,
            json,
            &onSuccess = handleUser,
            &onError = handleError
        );
    }

    view {
        <div>
            <button onclick={parseJson}>Parse JSON</button>
            <p>Status: {status}</p>
            <p>Name: {user.name}</p>
            <p>Age: {user.age}</p>
        </div>
    }
}

app {
    root = JsonTest;
}
