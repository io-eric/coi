// Test: JSON parsing with component-local pod types and match-based API

component JsonApp {
    pod User {
        string name;
        int age;
    }
    
    mut string result = "not parsed";

    def handleSuccess(User user, Meta meta) : void {
        if (meta.has(User.name) && meta.has(User.age)) {
            result = "User: " + user.name + ", age " + user.age;
        } else {
            result = "Partial data";
        }
    }

    def handleError(string error) : void {
        result = "Error: " + error;
    }
    
    mount {
        string jsonData = `{"name": "Bob", "age": 30}`;
        match (Json.parse(User, jsonData)) {
            Success(User user, Meta meta) => handleSuccess(user, meta);
            Error(string error) => handleError(error);
        };
    }
    
    view {
        <div>{result}</div>
    }
}

app {
    root = JsonApp;
}
