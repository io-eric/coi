// Test: JSON array parsing with match(Json.parse(Type[], ...))
// Tests parsing of root-level JSON arrays into vector of pod types

component JsonArrayTest {
    pod Show {
        string title;
        int id;
    }
    
    mut string result = "not parsed";
    mut int count = 0;

    def handleSuccess(Show[] shows, ShowMeta[] metas) : void {
        count = shows.length();
        if (count > 0) {
            result = "Parsed ${count} shows: ${shows[0].title}";
        } else {
            result = "Empty array";
        }
    }

    def handleError(string error) : void {
        result = "Parse error: " + error;
    }
    
    mount {
        string jsonArray = `[{"title":"Breaking Bad","id":1},{"title":"Game of Thrones","id":2}]`;
        match (Json.parse(Show[], jsonArray)) {
            Success(Show[] shows, ShowMeta[] metas) => handleSuccess(shows, metas);
            Error(string error) => handleError(error);
        };
    }
    
    view {
        <div>{result}</div>
    }
}

app {
    root = JsonArrayTest;
}
